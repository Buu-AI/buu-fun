"use client";

import { useGSAP } from "@gsap/react";
import gsap from "gsap";
import { DrawSVGPlugin } from "gsap/DrawSVGPlugin";
import { useRef } from "react";
gsap.registerPlugin(DrawSVGPlugin);

export default function MagicLoaderWand() {
  const ref = useRef<SVGSVGElement>(null);
  useGSAP(() => {
    const svgRef = ref.current;
    if (!svgRef) return;

    const context = gsap.context(() => {
      // Color palette for the wand
      const colors = ["#78DBFF", "#A378FF", "#EB78FF", "#A378FF", "#78DBFF"];

      // Enhanced wand wave animation with smooth color transitions
      const wandTimeline = gsap.timeline({
        repeat: Infinity,
        defaults: { ease: "sine.inOut", duration: 2.2 },
      });

      wandTimeline.to(svgRef, {
        keyframes: [
          { rotate: -15, color: colors[0] },
          { rotate: 0, color: colors[1] },
          { rotate: 15, color: colors[2] },
          { rotate: 0, color: colors[3] },
          { rotate: -10, color: colors[4] },
        ],
      });

      // Star bubble pop animation
      const stars = [
        "#star_1",
        "#star_2",
        "#star_3",
        "#star_4",
        "#star_5",
        "#star_6",
      ];

      // Set initial state for all stars
      gsap.set(stars, {
        scale: 0,
        opacity: 0,
        transformOrigin: "center center",
      });

      // Create staggered star animations
      stars.forEach((star, index) => {
        const starTimeline = gsap.timeline({
          repeat: -1,
          delay: index * 0.8, // Stagger the start times
        });

        starTimeline
          // Bubble up effect
          .to(star, {
            scale: 0.3,
            opacity: 0.6,
            duration: 0.4,
            // ease: "back.out(2)",
          })
          .to(star, {
            scale: 1,
            opacity: 1,
            duration: 0.6,
            // ease: "power2.out",
          })
          .to(star, {
            duration: 0.8,
            // ease: "none",
          })
          // Pop and scale down (bubble burst effect)
          .to(star, {
            scale: 1.3,
            opacity: 0.8,
            duration: 0.2,
            // ease: "power2.out",
          })
          .to(star, {
            scale: 0,
            opacity: 0,
            duration: 0.4,
            // ease: "back.in(2)",
          })
          // Wait before next cycle
          .to(star, {
            duration: 3.5,
          });
      });

      // Add subtle floating animation to wand parts
      gsap.to("#wand_head", {
        // y: -2,
        duration: 2,
        repeat: -1,
        yoyo: true,
      });

      gsap.to("#wand_tail", {
        // y: 1,
        duration: 2.5,
        repeat: -1,
        yoyo: true,
      });
    });

    return () => {
      context.revert();
    };
  }, []);

  return (
    <svg
      ref={ref}
      xmlns="http://www.w3.org/2000/svg"
      width="110"
      height="110"
      viewBox="0 0 110 110"
      fill="none"
    >
      <path
        id="wand_head"
        d="M89.3741 34.3744L82.5449 41.2035L68.7949 27.4535L75.6241 20.6244C77.5491 18.6994 80.0241 17.7827 82.4991 17.7827C84.9741 17.7827 87.4491 18.6994 89.3741 20.6244C93.1783 24.4285 93.1783 30.5702 89.3741 34.3744Z"
        fill="currentColor"
      />
      <path
        id="wand_tail"
        opacity="0.4"
        d="M82.5455 41.2051L29.7914 93.9593C25.9872 97.7634 19.8455 97.7634 16.0414 93.9593C12.2372 90.1551 12.2372 84.0134 16.0414 80.2092L68.7955 27.4551L82.5455 41.2051Z"
        fill="currentColor"
      />
      <path
        id="star_1"
        d="M42.8618 15.994L43.9543 12.2928C44.0609 11.9466 43.9543 11.5738 43.7145 11.3076C43.4747 11.0413 43.0483 10.9348 42.7019 11.0413L38.9978 12.133L35.2938 11.0413C34.9473 10.9348 34.5743 11.0413 34.3078 11.2809C34.0413 11.5472 33.9614 11.92 34.068 12.2662L35.1339 15.994L34.0413 19.6952C33.9347 20.0414 34.0413 20.4142 34.2811 20.6805C34.5476 20.9467 34.9207 21.0266 35.2671 20.9201L38.9978 19.855L42.7019 20.9467C42.8085 20.9734 42.8884 21 42.995 21C43.2615 21 43.5013 20.8935 43.7145 20.7071C43.981 20.4408 44.0609 20.068 43.9543 19.7219L42.8618 15.994Z"
        fill="currentColor"
      />
      <path
        id="star_2"
        d="M26.2984 43.5168L27.938 37.9458C28.098 37.4248 27.938 36.8637 27.5781 36.4629C27.1782 36.0621 26.6184 35.9419 26.0985 36.1022L20.5 37.7054L14.9415 36.0621C14.4216 35.9018 13.8618 36.0621 13.4619 36.4229C13.062 36.8236 12.942 37.3847 13.102 37.9058L14.7016 43.5168L13.062 49.0877C12.902 49.6087 13.062 50.1698 13.4219 50.5706C13.8218 50.9714 14.3816 51.0916 14.9015 50.9313L20.46 49.2881L26.0185 50.9313C26.1385 50.9714 26.2984 50.9714 26.4584 50.9714C26.8583 50.9714 27.2182 50.8111 27.5381 50.5305C27.938 50.1297 28.058 49.5686 27.898 49.0476L26.2984 43.5168Z"
        fill="currentColor"
      />
      <path
        id="star_3"
        d="M97.5483 66.5L99.8478 58.6832C100.072 57.9522 99.8478 57.1649 99.343 56.6025C98.7821 56.0402 97.9969 55.8715 97.2678 56.0964L89.472 58.4021L81.6761 56.0964C80.947 55.8715 80.1618 56.0964 79.6009 56.6025C79.0401 57.1649 78.8718 57.9522 79.0961 58.6832L81.3956 66.5L79.0961 74.3168C78.8718 75.0478 79.0961 75.8351 79.6009 76.3975C80.1618 76.9598 80.947 77.1285 81.6761 76.9036L89.472 74.5979L97.2678 76.9036C97.4361 76.9598 97.6604 76.9598 97.8848 76.9598C98.4456 76.9598 98.9504 76.7349 99.3991 76.3412C99.9599 75.7789 100.128 74.9916 99.9039 74.2605L97.5483 66.5Z"
        fill="currentColor"
      />
      <path
        id="star_4"
        d="M101.949 40.5L102.935 37.15C103.031 36.8366 102.935 36.4992 102.718 36.2582C102.478 36.0172 102.142 35.9449 101.829 36.0413L98.488 37.0295L95.1469 36.0413C94.8344 35.9449 94.4979 36.0413 94.2575 36.2582C94.0172 36.4992 93.9451 36.8366 94.0412 37.15L95.0267 40.5L94.0412 43.85C93.9451 44.1634 94.0412 44.5008 94.2575 44.7418C94.4979 44.9828 94.8344 45.0551 95.1469 44.9587L98.488 43.9705L101.829 44.9587C101.901 44.9828 101.997 44.9828 102.093 44.9828C102.334 44.9828 102.55 44.8864 102.742 44.7177C102.983 44.4767 103.055 44.1392 102.959 43.8259L101.949 40.5Z"
        fill="currentColor"
      />
      <path
        id="star_5"
        d="M79.2059 77.5078L79.9711 74.9081C80.0457 74.6649 79.9711 74.4031 79.8031 74.216C79.6165 74.029 79.3552 73.9729 79.1126 74.0477L76.5 74.7958L73.906 74.029C73.6634 73.9542 73.4022 74.029 73.2156 74.1973C73.0289 74.3844 72.973 74.6462 73.0476 74.8894L73.7941 77.5078L73.0289 80.1076C72.9543 80.3507 73.0289 80.6126 73.1969 80.7996C73.3835 80.9866 73.6448 81.0427 73.8874 80.9679L76.4813 80.2011L79.0753 80.9679C79.1313 80.9866 79.2059 80.9866 79.2806 80.9866C79.4672 80.9866 79.6352 80.9118 79.7844 80.7809C79.9711 80.5939 80.027 80.332 79.9524 80.0889L79.2059 77.5078Z"
        fill="currentColor"
      />
      <path
        id="star_6"
        d="M32.4065 15.9916L33.936 10.8099C34.0853 10.3253 33.936 9.80337 33.6003 9.43059C33.2645 9.0578 32.6676 8.90869 32.1826 9.0578L26.9969 10.5862L21.8113 9.0578C21.3263 8.90869 20.804 9.0578 20.4309 9.39331C20.0578 9.76609 19.9459 10.288 20.0952 10.7726L21.5874 15.9916L20.0578 21.1733C19.9086 21.658 20.0578 22.1799 20.3936 22.5527C20.7667 22.9254 21.289 23.0373 21.774 22.8882L26.9969 21.397L32.1826 22.9254C32.3318 22.9627 32.4438 23 32.593 23C32.9661 23 33.3018 22.8509 33.6003 22.5899C33.9734 22.2171 34.0853 21.6952 33.936 21.2106L32.4065 15.9916Z"
        fill="currentColor"
      />
    </svg>
  );
}
